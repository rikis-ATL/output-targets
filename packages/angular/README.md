# @stencil/angular-output-target

Stencil can generate Angular component wrappers for your web components. This allows your Stencil components to be used within an Angular application. The benefits of using Stencil's component wrappers over the standard web components include:

- Angular component wrappers will be detached from change detection, preventing unnecessary repaints of your web component.
- Web component events will be converted to RxJS observables to align with Angular's @Output() and will not emit across component boundaries.
- Optionally, form control web components can be used as control value accessors with Angular's reactive forms or [ngModel].

For a detailed guide on how to add the angular output target to a project, visit: https://stenciljs.com/docs/angular.

## Installation

```bash
npm install @stencil/angular-output-target
```

## Angular Support

| **@stencil/angular-output-target** | **Angular**     |
|------------------------------------|-----------------|
| 0.10.2                             | v18.x and lower |
| 1.0.0                              | v19.x and above |

## Usage

In your `stencil.config.ts` add the following configuration to the `outputTargets` section:

```ts
import { Config } from '@stencil/core';
import { angularOutputTarget } from '@stencil/angular-output-target';

export const config: Config = {
  namespace: 'demo',
  outputTargets: [
    angularOutputTarget({
      componentCorePackage: 'component-library',
      directivesProxyFile: '../component-library-angular/src/directives/proxies.ts',
      directivesArrayFile: '../component-library-angular/src/directives/index.ts',
    }),
    {
      type: 'dist',
      esmLoaderPath: '../loader',
    },
  ],
};
```

## Config Options

| Property               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `componentCorePackage` | The NPM package name of your Stencil component library. This package is used as a dependency for your Angular wrappers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `directivesProxyFile`  | The output file of all the component wrappers generated by the output target. This file path should point to a location within your Angular library/project.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `directivesArrayFile`  | The output file of a constant of all the generated component wrapper classes. Used for easily declaring and exporting the generated components from an `NgModule`. This file path should point to a location within your Angular library/project.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `valueAccessorConfigs` | The configuration object for how individual web components behave with Angular control value accessors.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `excludeComponents`    | An array of tag names to exclude from generating component wrappers for. This is helpful when have a custom framework implementation of a specific component or need to extend the base component wrapper behavior.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `outputType`           | Specifies the type of output to be generated. It can take one of the following values: <br />1. `component`: Generates all the component wrappers to be declared on an Angular module. This option is required for Stencil projects using the `dist` hydrated output.<br /> 2. `scam`: Generates a separate Angular module for each component.<br /> 3. `standalone`: Generates standalone component wrappers.<br /> Both `scam` and `standalone` options are compatible with the `dist-custom-elements` output. <br />Note: Please choose the appropriate `outputType` based on your project's requirements and the desired output structure. Defaults to `component`. |
| `customElementsDir`    | This is the directory where the custom elements are imported from when using the [Custom Elements Bundle](https://stenciljs.com/docs/custom-elements). Defaults to the `components` directory. Only applies for `outputType: "scam"` or `outputType: "standalone"`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `inlineProperties` | Experimental. When true, tries to inline the properties of components. This is required to enable Angular Language Service to type-check and show jsdocs when using the components in html-templates.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `generateIndividualComponents` | When `true`, generates individual component files that enable tree shaking. Each component gets its own file and a `components.ts` file exports all components. This allows bundlers to only include components that are actually imported. When `false` (default), generates a single monolithic proxy file. Defaults to `false` for backward compatibility. |

## Tree Shaking Support

Starting from version 1.1.0, the Angular output target supports tree shaking to reduce bundle sizes by only including components that are actually used in your application.

### Enabling Tree Shaking

To enable tree shaking, set `generateIndividualComponents: true` in your configuration:

```ts
angularOutputTarget({
  componentCorePackage: 'my-component-library',
  directivesProxyFile: '../angular-workspace/projects/component-library/src/directives/proxies.ts',
  directivesArrayFile: '../angular-workspace/projects/component-library/src/directives/index.ts',
  generateIndividualComponents: true, // Enable tree shaking
})
```

### Generated File Structure

When tree shaking is enabled, the output target generates the following structure:

```
directives/
├── my-button.ts           # Individual component file
├── my-checkbox.ts         # Individual component file  
├── my-input.ts            # Individual component file
├── components.ts          # Exports all components from individual files
├── proxies.ts            # Re-exports from individual components (backward compatibility)
└── index.ts              # DIRECTIVES array with individual imports
```

## Import Patterns and Use Cases

### Before Update (Traditional Pattern)

**Configuration:**
```ts
angularOutputTarget({
  generateIndividualComponents: false, // Default
})
```

**Generated Files:**
- Single `proxies.ts` file containing all components
- Monolithic bundle approach

**Import Pattern:**
```typescript
// All components imported together (no tree shaking)
import { MyButton, MyCheckbox, MyInput } from 'my-component-library-angular';
```

**Characteristics:**
- ❌ No tree shaking - all components bundled together
- ❌ Larger bundle sizes
- ✅ Simple import pattern
- ✅ Backward compatible

### After Update (Tree Shaking Pattern)

**Configuration:**
```ts
angularOutputTarget({
  generateIndividualComponents: true, // Enable tree shaking
})
```

**Generated Files:**
- Individual `.ts` file for each component
- `components.ts` that exports all components
- `proxies.ts` for backward compatibility

**Import Patterns (Multiple Options):**

#### Option 1: Named Imports from Main Package (Recommended)
```typescript
// Tree-shakable imports from main package
import { MyButton, MyCheckbox } from 'my-component-library-angular';
// Only MyButton and MyCheckbox will be included in bundle
```

#### Option 2: Individual File Imports
```typescript
// Direct import from individual component files
import { MyButton } from 'my-component-library-angular/directives/my-button';
import { MyCheckbox } from 'my-component-library-angular/directives/my-checkbox';
```

#### Option 3: Mixed Imports (Gradual Migration)
```typescript
// Some from main package, some from individual files
import { MyButton } from 'my-component-library-angular';
import { MyCheckbox } from 'my-component-library-angular/directives/my-checkbox';
```

**Characteristics:**
- ✅ Tree shaking enabled - only used components included
- ✅ Smaller bundle sizes
- ✅ Multiple import patterns supported
- ✅ Fully backward compatible
- ✅ Gradual migration possible

### Use Cases and Migration Strategies

#### 1. New Projects
For new projects, enable tree shaking from the start:

```ts
angularOutputTarget({
  generateIndividualComponents: true,
})
```

Use named imports from the main package:
```typescript
import { MyButton, MyInput } from 'my-component-library-angular';
```

#### 2. Existing Projects (Gradual Migration)
Enable tree shaking while maintaining existing imports:

```ts
angularOutputTarget({
  generateIndividualComponents: true, // Enable tree shaking
})
```

Existing imports continue to work but now benefit from tree shaking:
```typescript
// This now supports tree shaking automatically
import { MyButton, MyInput } from 'my-component-library-angular';
```

#### 3. Large Applications (Maximum Optimization)
For applications using only a subset of components from large libraries:

```typescript
// Only import what you use
import { MyButton } from 'my-component-library-angular';
// MyCheckbox, MyInput, and other unused components excluded from bundle
```

#### 4. Bundle Size Analysis
Enable bundle analysis to verify tree shaking effectiveness:

```bash
# Build with analysis
ng build --source-map
npx webpack-bundle-analyzer dist/main.*.js
```

### Bundle Size Impact

Tree shaking provides significant benefits, especially for large component libraries:

| Library Size | Components Used | Bundle Reduction |
|--------------|-----------------|------------------|
| 50 components | 5 components | ~80-90% |
| 100 components | 10 components | ~85-95% |
| 20 components | 15 components | ~20-30% |

### Migration Guide

#### Step 1: Enable Tree Shaking
Update your Stencil configuration:
```ts
generateIndividualComponents: true
```

#### Step 2: Rebuild Component Library
```bash
npm run build
```

#### Step 3: Verify Tree Shaking
Create a test app importing only specific components and verify bundle size.

#### Step 4: Update Imports (Optional)
Gradually migrate to more specific imports for maximum optimization:

```typescript
// Before
import { MyButton, MyCheckbox, MyInput, /* ...50 other components */ } from 'library';

// After
import { MyButton, MyInput } from 'library'; // Only import what you use
```

### Backward Compatibility

Tree shaking is **fully backward compatible**:

- ✅ Existing imports continue to work unchanged
- ✅ No breaking changes to APIs
- ✅ Gradual migration supported
- ✅ Can be enabled/disabled via configuration
- ✅ All existing functionality preserved
